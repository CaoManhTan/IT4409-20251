<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>React CRUD</title>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #007bff;
      color: white;
    }
    input[type="text"] {
      padding: 8px;
      margin: 5px 0;
      width: calc(100% - 18px);
    }
    button {
      padding: 5px 10px;
      margin: 5px 2px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.8;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      width: 400px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .form-add {
        border: 1px solid #ccc;
        padding: 15px;
        border-radius: 5px;
        background: #f9f9f9;
        margin-top: 15px;
    }
  </style>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

  <div id="root"></div>

  <script type="text/babel">
    
    function AddUser({ onAdd }) {
      const [adding, setAdding] = React.useState(false);
      
      const initialUserState = {
        name: "", username: "", email: "",
        address: { street: "", suite: "", city: ""},
        phone: "", website: ""
      };
      const [user, setUser] = React.useState(initialUserState);

      const handleChange = (e) => {
        const { id, value } = e.target;

        if (["street", "suite", "city"].includes(id)) {
          setUser({
            ...user,
            address: {
              ...user.address,
              [id]: value
            }
          });
        } else {
          setUser({
            ...user,
            [id]: value
          });
        }
      };

      const handleAdd = () => {
        if (user.name === "" || user.username === "") {
          alert("Vui lòng nhập Name và Username!");
          return;
        }
        onAdd(user);
        setUser(initialUserState);
        setAdding(false);
      };

      if (!adding) {
        return <button onClick={() => setAdding(true)}>Thêm mới</button>;
      }

      return (
        <div className="form-add">
          <h3>Thêm người dùng mới</h3>
          <input id="name" value={user.name} onChange={handleChange} placeholder="Name" />
          <input id="username" value={user.username} onChange={handleChange} placeholder="Username" />
          <input id="email" value={user.email} onChange={handleChange} placeholder="Email" />
          <input id="street" value={user.address.street} onChange={handleChange} placeholder="Street" />
          <input id="city" value={user.address.city} onChange={handleChange} placeholder="City" />
          <br />
          <button onClick={handleAdd}>Lưu</button>
          <button onClick={() => setAdding(false)}>Hủy</button>
        </div>
      );
    }
    
    function SearchForm({ onChangeValue }) {
      return (
        <input
          type="text"
          style={{ width: '100%', boxSizing: 'border-box' }}
          placeholder="Tìm theo name, username"
          onChange={(e) => onChangeValue(e.target.value)}
        />
      );
    }
    
    function ResultTable({ keyword, user, onAdded }) {
      const [users, setUsers] = React.useState([]);
      const [loading, setLoading] = React.useState(true);
      
      const [editing, setEditing] = React.useState(null);

      React.useEffect(() => {
        fetch("https://jsonplaceholder.typicode.com/users")
          .then(res => res.json())
          .then(data => {
            setUsers(data);
            setLoading(false);
          });
      }, []);

      React.useEffect(() => {
        if (user) {
          setUsers((prev) => [
            ...prev,
            { ...user, id: prev.length + 1 }
          ]);
          onAdded();
        }
      }, [user]);

      const handleEditChange = (e) => {
        const { id, value } = e.target;
        if (["street", "suite", "city"].includes(id)) {
          setEditing({
            ...editing,
            address: {
              ...editing.address,
              [id]: value
            }
          });
        } else {
          setEditing({
            ...editing,
            [id]: value
          });
        }
      };

      function editUser(user) {
        setEditing({ ...user, address: { ...user.address } });
      }

      function saveUser() {
        setUsers(prev => prev.map(u =>
          u.id === editing.id ? editing : u
        ));
        setEditing(null);
      }
      
      function removeUser(id) {
        if (window.confirm("Bạn có chắc chắn muốn xóa người dùng này?")) {
          setUsers((prev) => prev.filter((u) => u.id !== id));
        }
      }

      const filteredUsers = users.filter(
        (u) =>
          u.name.toLowerCase().includes(keyword.toLowerCase()) ||
          u.username.toLowerCase().includes(keyword.toLowerCase())
      );

      if (loading) {
        return <div>Loading...</div>;
      }

      return (
        <div>
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Username</th>
                <th>Email</th>
                <th>City</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {filteredUsers.map((u) => (
                <tr key={u.id}>
                  <td>{u.id}</td>
                  <td>{u.name}</td>
                  <td>{u.username}</td>
                  <td>{u.email}</td>
                  <td>{u.address.city}</td>
                  <td>
                    <button onClick={() => editUser(u)}>Sửa</button>
                    <button onClick={() => removeUser(u.id)}>Xóa</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
          
          {editing && (
            <div className="modal-overlay">
              <div className="modal-content">
                <h3>Chỉnh sửa người dùng</h3>
                <input id="name" value={editing.name} onChange={handleEditChange} placeholder="Name" />
                <input id="username" value={editing.username} onChange={handleEditChange} placeholder="Username" />
                <input id="email" value={editing.email} onChange={handleEditChange} placeholder="Email" />
                <input id="street" value={editing.address.street} onChange={handleEditChange} placeholder="Street" />
                <input id="city" value={editing.address.city} onChange={handleEditChange} placeholder="City" />
                <br />
                <button onClick={saveUser}>Lưu</button>
                <button onClick={() => setEditing(null)}>Hủy</button>
              </div>
            </div>
          )}
        </div>
      );
    }
    
    function App() {
      const [kw, setKeyword] = React.useState("");
      const [newUser, setNewUser] = React.useState(null);
      
      return (
        <div>
          <h1>Quản lý người dùng</h1>
          
          <SearchForm onChangeValue={setKeyword} />
          <AddUser onAdd={setNewUser} />
          
          <ResultTable
            keyword={kw}
            user={newUser}
            onAdded={() => setNewUser(null)}
          />
        </div>
      );
    }
    
    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);

  </script>

</body>
</html>